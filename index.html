<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DF_2d: DF_2d</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DF_2d
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Two phase immiscible flow in fractured porous media</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DF_2d </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>DF_2d is a C++ program written by me, Shayan Hoshyari <a href="#" onclick="location.href='mai'+'lto:'+'s.h'+'os'+'hya'+'ri'+'@gm'+'ai'+'l.c'+'om'; return false;">s.hos<span style="display: none;">.nosp@m.</span>hyar<span style="display: none;">.nosp@m.</span>i@gma<span style="display: none;">.nosp@m.</span>il.c<span style="display: none;">.nosp@m.</span>om</a> , as a part of my B.Sc. project. This program simulates two-phase immiscible flow in fractured porous media using a finite volume and the discrete fracture method. The details of the project and the theoretical basis of the numerical method can be found in my thesis, in df2d/pdf folder.</p>
<p>In this page I will explain:</p>
<ol type="1">
<li>How to build the program.</li>
<li>How to run the program.</li>
<li>A brief explanation of how the code works, and how to start reading this documentation.</li>
</ol>
<h1><a class="anchor" id="build_sec"></a>
Building df2d</h1>
<p>Building the program should create an executable file called df2d. Before building the executable file you should:</p>
<ol type="1">
<li>Have a GNU/Linux on your machine, e.g. <a href="http://www.ubuntu.com/">ubuntu </a>, and the gnu compiler.</li>
<li>Have an installed version of <a href="http://www.mcs.anl.gov/petsc/">Petsc numerical library </a>. If Petsc is installed, the global variables $PETSC_DIR and $PETSC_ARCH should be configured correctly.</li>
<li>Have an installed version of <a href="http://arma.sourceforge.net/">Armadillo linear algebra library </a>. If the library and header files are not in a place where the compiler can find them automatically, e.g. /usr/lib and /usr/include you should change the makefile. The instructions to do so can be found in the makefile.</li>
<li>In order to visualize the results you need <a href="http://www.paraview.org/">Paraview </a>.</li>
<li>In order to create a mesh that df2d can read you need either <a href="https://www.cs.cmu.edu/~quake/triangle.html">Triangle </a> or <a href="http://geuz.org/gmsh/">Gmsh </a>.</li>
</ol>
<p>If everything is ready simply start the shell, go to the df2d/code folder and type:</p>
<p>$ make df2d</p>
<p>This will create an executable file named df2d in the df2d/code/bin folder. In order to use it easier it is better to put a shortuct of it in your ~/bin folder.</p>
<p>$ ln -s -T &lt;/address/to/df2d/exe/file&gt; ~/bin</p>
<h1><a class="anchor" id="run_sec"></a>
Running df2d</h1>
<p>In order to run df2d you have to create a folder for your problem. I will call it the case folder. There are some case folders in df2d/code/examples. For example df2d/code/examples/bench3 is the case folder for the third benchmark problem solved in my thesis. Each folder is comprised of the following files and folders:</p>
<p>a folder to write results in: result/<br/>
 a folder to write restart files in: restart/<br/>
 a file containing solver input: solver.config<br/>
 a file containing petsc commands: petsc.config<br/>
 a file containing initial condition: initial<br/>
 gmsh mesh file or triangle mesh files: mesh.msh or mesh.ele + mesh.node + mesh.poly</p>
<h2><a class="anchor" id="result_subsec"></a>
result folder</h2>
<p>Before running df2d this folder can be empty. After df2d is ran successfully it will be filled with a set of .vtk files, which can be openned with Paraview and a .flow file. The .flow file is an ascii file which simply stores the amount of fluid injected and extracted from the reservoir at each time step.</p>
<h2><a class="anchor" id="restart_subsec"></a>
restart folder</h2>
<p>Before running df2d this folder can be empty. Whenever df2d writes a .vtk file it also writes a restart file as well. If your simulation is interrupted you can rename the restart file to initial and put it in the case folder. When you run the df2d it will use the restart file as the initial conditions.</p>
<h2><a class="anchor" id="petsc_subsec"></a>
petsc.config</h2>
<p>The pressure equation is solved using the Petsc library. You can pass the Petsc options through this file. For example the following lines:</p>
<div class="fragment"><div class="line">-ksp_type bcgs</div>
<div class="line">-pc_type  ilu</div>
<div class="line">-pc_factor_levels 1    </div>
<div class="line">-ksp_initial_guess_nonzero 1</div>
</div><!-- fragment --><p>Mean that the BiCGStab method is used with ILU(1) preconditioner. Also the pressure field from the last time step is used as the initial guess for the current time step pressure equation. Or the following lines:</p>
<div class="fragment"><div class="line">-ksp_type preonly</div>
<div class="line">-pc_type  lu</div>
</div><!-- fragment --><p>Mean that the pressure equation is solved using the multi front method, which is a generalization of the gaussian elimination for sparse matrices. Please consult Petsc's documentation.</p>
<h2><a class="anchor" id="solver_subsec"></a>
solver.config</h2>
<p>This file contains all the options passed to df2d. It should have a structure like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor"> # anything after this sign is a comment</span></div>
<div class="line"><span class="preprocessor"></span> $regiondata</div>
<div class="line">    $region</div>
<div class="line">            type    mat</div>
<div class="line">            id      &lt;mesh generator id&gt;</div>
<div class="line">            phi     &lt;porosity&gt;</div>
<div class="line">            pd      &lt;Pd capillary pressure coefficeint&gt;</div>
<div class="line">            kr      &lt;relative permeabiliry curve&gt;</div>
<div class="line">                k       &lt;absolute permeabiliry tensor: kxx,kxy;kyx,kyy&gt;</div>
<div class="line">    $region </div>
<div class="line">            type    frac</div>
<div class="line">            id      &lt;mesh generator id&gt;</div>
<div class="line">            phi     &lt;porosity&gt;</div>
<div class="line">            pd      &lt;Pd capillary pressure coefficeint&gt;</div>
<div class="line">            kr      &lt;relative permeabiliry curve&gt;</div>
<div class="line">            k       &lt;absolute permeabiliry scalar: k&gt;</div>
<div class="line">            e       &lt;thickness&gt;</div>
<div class="line">    $region</div>
<div class="line">            type    bnd</div>
<div class="line">            id      &lt;mesh generator id&gt;</div>
<div class="line">            stype   &lt;gpczero or sconst&gt;</div>
<div class="line">            ptype   &lt;pconst or qconst&gt;</div>
<div class="line">            value   &lt;the value of p or q at the boundary depending on ptype&gt;</div>
<div class="line">            </div>
<div class="line">    ... &lt;other regions data&gt;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> $fixeddata</div>
<div class="line">    dm      &lt;M dimensionless number&gt;</div>
<div class="line">    dn      &lt;N dimensionless number&gt;</div>
<div class="line">    dp      &lt;P dimensionless number&gt;</div>
<div class="line">    dgw     &lt;Gw dimensionless number: \rho_w*g*L/P* &gt;</div>
<div class="line">    dgn     &lt;Gn dimensionless number: \rho_n*g*L/P* &gt;</div>
<div class="line">    gorigin &lt;origin of gravity field: x0 y0&gt;</div>
<div class="line">    gradz   &lt;\nabla h: x y&gt;</div>
<div class="line">    starttime       &lt;Time that simulation starts from&gt;</div>
<div class="line">    stoptime        &lt;Time when simulation ends&gt;</div>
<div class="line">    timestep        &lt;Initial time step&gt;</div>
<div class="line">    maxtimestep     &lt;Maximum allowed time step&gt;</div>
<div class="line">    mintimestep     &lt;Minimum allowed time step&gt;</div>
<div class="line">    maxdeltas       &lt;Maximum allowed change in saturation&gt;</div>
<div class="line">    mindeltas       &lt;Minimum allowed change in saturation&gt;</div>
<div class="line">    beta            &lt;Beta as in my thesis&gt;</div>
<div class="line">    maxtimeiteration        &lt;Maximum number of iterations to solve the saturation equation in order to find a nice dt&gt;</div>
<div class="line">    nfilebegin              &lt;number of .vtk file to begin with&gt;</div>
<div class="line">    nfileend                &lt;number of .vtk file to finish with&gt;</div>
<div class="line">    jmodel                  &lt;the cappilary curve used&gt;</div>
<div class="line">    meshtype                &lt;the mesh input format used&gt;</div>
<div class="line">    visualtype              &lt;the output format used: must be vtk&gt;</div>
<div class="line">    visualduplicate         &lt;should be either 0 1 2&gt;</div>
<div class="line"></div>
<div class="line">$setfield</div>
<div class="line">        &lt;number of command, e.g. 2&gt;</div>
<div class="line">    circle  &lt;origin-x&gt;   &lt;origin-y&gt;   &lt;radius&gt;  &lt;s-value&gt;</div>
<div class="line">    rectangle &lt;left-lower-corner-x&gt;  &lt;left-lower-corner-y&gt;  &lt;right-upper-corner-x&gt;  &lt;right-upper-corner-x&gt; &lt;s-value&gt;</div>
<div class="line">    ... &lt;other commands&gt;</div>
</div><!-- fragment --><p>After $regions you should give df2d the details about each region. Firstly you should say what the region is. The available options are: </p>
<div class="fragment"><div class="line">bnd mat frac</div>
</div><!-- fragment --><p> For a boundary, matrix region and fracture region respectively. Afterwards you should mention the ID that the mesh generator has assigned to the elements belonging to that region.</p>
<p>For a boundary region, you should specify the boundary condition for s and p respectively. For saturation boundary conditions sconst(Dirichlet) and gpczero(Neumann) conditions are available. For pressure pconst(Dirichlet) and qconst(Neumann) conditions are available. The value for velocity or pressure on the boundary should also be mentioned.</p>
<p>For matrix and fracture regions the value for Pd, porosity and K has to be given. For matrix regions K should be in the format: kxx,kxy;kyx,kyy and for the fractures in the format: k. Relative permeability should be given in one of the following formats:</p>
<p>krw = krw0(s)^vw , krn = krn0(1-s)^vn: </p>
<div class="fragment"><div class="line">firooz &lt;krw0&gt; &lt;krn0&gt; &lt;vw0&gt; &lt;vn0&gt;</div>
</div><!-- fragment --><p> Vangenuchten: </p>
<div class="fragment"><div class="line">vang &lt;krw0&gt; &lt;krn0&gt; &lt;m&gt;</div>
</div><!-- fragment --><p> Brooks-Corey: </p>
<div class="fragment"><div class="line">brooks &lt;krw0&gt; &lt;krn0&gt; &lt;lambda&gt;</div>
</div><!-- fragment --><p>After $fixeddata all the mentioned parameters should be given. Note that the J curve should be given in the forms:</p>
<p>-ln(S): </p>
<div class="fragment"><div class="line">firooz </div>
</div><!-- fragment --><p> No cappilary pressure: </p>
<div class="fragment"><div class="line">zero</div>
</div><!-- fragment --><p> linear (1-s): </p>
<div class="fragment"><div class="line">linear</div>
</div><!-- fragment --><p> VanGenuchten: </p>
<div class="fragment"><div class="line">vang &lt;m&gt; &lt;epsilon <span class="keywordflow">for</span> truncated curve&gt;</div>
</div><!-- fragment --><p> Brooks-Corey: </p>
<div class="fragment"><div class="line">brooks &lt;lambda&gt;</div>
</div><!-- fragment --><p>$setfield is for assigning initial conditions. If you want to change the initial conditions, you should assign rectangles and circles and change the value of saturation inside them.</p>
<h2><a class="anchor" id="initial_subsec"></a>
initial</h2>
<p>This is a text file and shows the initial conditions. It can have two forms:</p>
<div class="fragment"><div class="line">%InitialCondition</div>
<div class="line">%mod n</div>
<div class="line">&lt;value of saturation at node 0&gt;</div>
<div class="line">&lt;value of saturation at node 1&gt;</div>
<div class="line">...</div>
<div class="line">&lt;value of saturation at last node&gt;  </div>
</div><!-- fragment --><p> This type can only be created using the df2d. Either by copying a restart file from restart folder or running df2d with the -s switch.</p>
<div class="fragment"><div class="line">%InitialCondition</div>
<div class="line">%mod u</div>
<div class="line">&lt;constant value <span class="keywordflow">for</span> saturation all over the porous media&gt; </div>
</div><!-- fragment --><p> If you are using df2d in a case folder for the first time this options should be used.</p>
<h2><a class="anchor" id="mesh_subsec"></a>
Mesh files</h2>
<p>The mesh files should be prepared by either Triangle or Gmsh.</p>
<p>When using triangle a mesh.poly file should be present, defining all the fractures and the boundaries. All the line segments in this file should have a bounary marker which is their mesh generator ID. A mesh.ele file should be present defining all the matrix elements. All the triangles should have a region number indicating their mesh generator ID as well. A mesh.node file should be present defining all the nodes.</p>
<p>When using a mesh.msh file from Gmsh, the file should contain: All the elements on the boundary. All the elements on the fracture. All the matrix elements (either quads or triangles ). All the point source and sinks in the form of node elements. Every element should have a physical label, i.e. its mesh generator ID.</p>
<h2><a class="anchor" id="setfield_subsec"></a>
Changing initial conditions</h2>
<p>To change the initial file according to your instructions in the solver.config file simply run df2d using the -s switch:</p>
<div class="fragment"><div class="line">$ df2d -d /path/to/<span class="keywordflow">case</span>/folder -s</div>
</div><!-- fragment --><p>Doing so df2d only changes your initial file. If the -d switch is not given, df2d assumes that the current folder is the case folder.</p>
<h2><a class="anchor" id="run_subsec"></a>
Running the simulation</h2>
<p>If everything is ready you can start a simulation by typing:</p>
<div class="fragment"><div class="line">$ df2d -d /path/to/<span class="keywordflow">case</span>/folder </div>
</div><!-- fragment --><h1><a class="anchor" id="how_sec"></a>
How to read this documentation</h1>
<p>Here I will try to explain the main parts of df2d and this documentation. Below you will see a figure showing the source code files:</p>
<div class="image">
<img src="../../docfiles/files.svg"  height="460" width="367"/>
</div>
<p>The source code has been categorized in three modules. <a class="el" href="group__mesh__module.html">Mesh</a> is responsible for handling the mesh and producing the local matrices and the regions data. The <a class="el" href="group__edat__module.html">External Data</a> is responsible for saving all the variables at each node or element, the injected and extracted fluid, the current working directory, etc. The <a class="el" href="group__dr__module.html">Driver Functions</a> constitutes of functions that handle the general flow of the program, e.g. reading the input files, marching through time, writing the results, etc.</p>
<p>It would be easier to read the documentations from bottom to up, i.e. first read main.cpp, then read the driver module and so forth. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 21 2015 22:55:22 for DF_2d by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
